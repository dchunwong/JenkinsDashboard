function countByDate(e,t){for(var a={},r={},i={},s={},n={},o={},l={},d=0;d<e.length;d++){var h=new Date(1e3*e[d].date);t&&h.setHours(0,0,0,0),h=h.valueOf(),a[h]||(a[h]=0),i[h]||(i[h]=0),r[h]||(r[h]=0),o[h]||(o[h]=0),n[h]||(n[h]=0),s[h]||(s[h]=0),l[h]||(l[h]=[]),l[h].push(e[d].build);for(var c,g=0;g<e[d].test_list.length;g++)c=e[d].test_list,"Passed"==c[g].result?a[h]++:"Failure"==c[g].result?i[h]++:"Error"==c[g].result?r[h]++:"Expected Failure"==c[g].result?n[h]++:"Skipped"==c[g].result?o[h]++:"Unexpected Pass"==c[g].result&&s[h]++}return{passes:a,fails:i,errors:r,skips:o,xfails:n,uxpass:s,builds:l}}function keysToXY(e){var t,a=[],r=Object.keys(e);r.sort();for(var i=0;i<r.length;i++)t=+r[i],t/=1e3,a[i]={x:t,y:e[r[i]]};return a}function makeGraph(e,t,a,r){var i,s,n,o,l,d,h,c,g=countByDate(e,r);s=window.innerWidth<866?window.innerWidth/866*scaler:1,i=r?"bar":"area",n=new Rickshaw.Graph({element:document.querySelector("#chart"),renderer:i,interpolation:"linear",stacked:!0,stroke:!0,width:t*s,height:a*s,builds:g.builds,series:[{name:"X-Fails",data:keysToXY(g.xfails),color:"darkorange"},{name:"Skips",data:keysToXY(g.skips),color:"darkkhaki"},{name:"UX-Passes",data:keysToXY(g.uxpass),color:"steelblue"},{name:"Fails",data:keysToXY(g.fails),color:"salmon"},{name:"Errors",data:keysToXY(g.errors),color:"firebrick"},{name:"Passes",data:keysToXY(g.passes),color:"seagreen"}]}),l=new Rickshaw.Graph.Axis.Time({graph:n,timeFixture:new Rickshaw.Fixtures.Time.Local}),o=new Rickshaw.Graph.Axis.Y({graph:n,height:baseHeight*s,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.getElementById("yaxis")}),d=new Rickshaw.Graph.HoverDetail({graph:n,xFormatter:function(e){return r?new Date(1e3*e).toDateString()+"<br>Build(s): "+g.builds[1e3*e].toString().replace(/\,/g," "):new Date(1e3*e).toString()+"<br>Build: "+g.builds[1e3*e].toString().replace(/\,/g," ")}}),c=new Rickshaw.Graph.Legend({graph:n,element:document.getElementById("legend")}),h=new Rickshaw.Graph.Behavior.Series.Toggle({graph:n,legend:c}),n.render();var u="#chart .detail .x_label";return r?$("#chart").on("click",function(){var e=new Date($(u).text().split("Build(s)")[0]);window.location=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()}):$("#chart").on("click",function(){var e=$(u).text().split("Build(s)")[1].split(" ")[1],t=document.URL.split("/");window.location="/job/"+t[t.indexOf("job")+1]+"/"+e}),{graph:n,y:o,x:l,legend:c,shelving:h,hover:d}}function displayLogs(e){element=e.currentTarget,modContainerSelector=$("#modal_container"),$("#modal_content")[0].innerHTML=test_data[+$(element).parent()[0].getAttribute("data-idx")].test_list[element.getAttribute("data-idx")].log,modContainerSelector.fadeIn(),modContainerSelector.css("display","block"),$("#modal_close").click(function(){modContainerSelector.fadeOut(function(){modContainerSelector.css("display","none")})})}var baseWidth=810,baseHeight=375,scaler=.9,graphStuff=makeGraph(test_data,baseWidth,baseHeight,clearDate);$(window).resize(function(){var e=$("#chart").find("svg");window.innerWidth>866?graphStuff.graph.width<baseWidth&&(graphStuff.graph.configure({width:baseWidth,height:baseHeight}),e.attr("width",baseWidth).attr("height",baseWidth),graphStuff.graph.render()):(modifier=window.innerWidth<371?371/866*scaler:window.innerWidth/866*scaler,graphStuff.graph.configure({width:baseWidth*modifier,height:baseHeight*modifier}),e.attr("width",baseWidth*modifier).attr("height",baseHeight*modifier),graphStuff.y.height=baseWidth*modifier,graphStuff.graph.render(),graphStuff.y.render())}),$(".Error").click(displayLogs),$(".Failure").click(displayLogs),$("Expected.Failure").click(displayLogs);
